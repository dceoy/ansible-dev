box:
  id: dceoy/wercker-base
  entrypoint: /bin/bash -c
build:
  steps:
    - script:
        name: Install packages
        code: |
          apt-get -y update
          apt-get -y install aptitude ssh sudo libffi-dev libssl-dev python3-crypto python3-dev python3-pip
    - script:
        name: Install ansible
        code: |
          pip3 install -U ansible
    - script:
        name: Set up ssh
        code: |
          service ssh start
          cp -r tests/ssh ~/.ssh
          chmod 600 ~/.ssh/*
          ssh localhost 'echo Connected!'
    - script:
        name: Test a build
        code: |
          ./tests/build.sh
  after-steps:
    - slack-notifier:
        url: $SLACK_URL
        channel: $SLACK_CHANNEL
